---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: openclaw-r2-secret
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    creationPolicy: Owner
    deletionPolicy: Retain
    template:
      data:
        RESTIC_REPOSITORY: "s3:{{ .RESTIC_REPOSITORY }}/openclaw"
        RESTIC_PASSWORD: "{{ .RESTIC_PASSWORD }}"
        AWS_ACCESS_KEY_ID: "{{ .AWS_ACCESS_KEY_ID }}"
        AWS_SECRET_ACCESS_KEY: "{{ .AWS_SECRET_ACCESS_KEY }}"
  dataFrom:
    - extract:
        key: volsync-restic-r2
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-secret
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: *name
    template:
      data:
        ## Gateway token for authentication
        OPENCLAW_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        ## Discord Bot Token
        DISCORD_BOT_TOKEN: "{{ .DISCORD_BOT_TOKEN }}"
        ## GH Access
        GITHUB_APP_CLIENT_ID: "{{ .BOT_APP_ID }}"
        GITHUB_APP_CLIENT_SECRET: "{{ .BOT_APP_CLIENT_SECRET }}"
        GITHUB_APP_ID: "{{ .BOT_APP_ID }}"
        GITHUB_APP_INSTALLATION_ID: "{{ .BOT_APP_INSTALLATION_ID }}"
        GITHUB_APP_PRIVATE_KEY: "{{ .BOT_APP_PRIVATE_KEY }}"
        ## API Keys
        GOOGLE_GEMINI_API_KEY: "{{ .GOOGLE_GEMINI_API_KEY }}"
        OLLAMA_API_KEY: "ollama-local"
        OLLAMA_HOST: "http://ollama.ollama.svc.cluster.local"
  dataFrom:
    - extract:
        key: openclaw-secret
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: *name
    template:
      data:
        ## OpenClaw configuration file
        openclaw.json: |
          {
            "commands": {
              "native": "auto",
              "nativeSkills": "auto"
            },
            "agents": {
              "defaults": {
                "model": {
                  "primary": "antigravity-proxy/gemini-3-flash"
                },
                "models": {
                  "antigravity-proxy/gemini-3-flash": {
                    "alias": "gemini"
                  }
                },
                "workspace": "/home/node/.openclaw/workspace",
                "compaction": {
                  "mode": "safeguard"
                },
                "maxConcurrent": 4,
                "subagents": {
                  "maxConcurrent": 8
                },
                "memorySearch": {
                  "provider": "gemini",
                  "model": "gemini-embedding-001",
                  "fallback": "local",
                  "local": {
                    "modelPath": "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf"
                  },
                  "sync": {
                    "watch": true
                  },
                  "query": {
                    "hybrid": {
                      "enabled": true,
                      "vectorWeight": 0.7,
                      "textWeight": 0.3
                    }
                  }
                }
              }
            },
            "models": {
              "providers": {
                "antigravity-proxy": {
                  "baseUrl": "http://antigravity-gateway.antigravity-gateway.svc.cluster.local:8080",
                  "apiKey": "test",
                  "api": "anthropic-messages",
                  "models": [
                    {
                      "id": "gemini-3-flash",
                      "name": "Gemini 3 Flash",
                      "reasoning": false,
                      "input": ["text"],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 1048576,
                      "maxTokens": 8192
                    },
                    {
                      "id": "gemini-3-pro-high",
                      "name": "Gemini 3 Pro High",
                      "reasoning": false,
                      "input": ["text"],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 1048576,
                      "maxTokens": 8192
                    },
                    {
                      "id": "claude-sonnet-4-5",
                      "name": "Claude Sonnet 4.5",
                      "reasoning": false,
                      "input": ["text"],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 200000,
                      "maxTokens": 8192
                    },
                    {
                      "id": "claude-sonnet-4-5-thinking",
                      "name": "Claude Sonnet 4.5 Thinking",
                      "reasoning": true,
                      "input": ["text"],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 200000,
                      "maxTokens": 8192
                    },
                    {
                      "id": "claude-opus-4-5-thinking",
                      "name": "Claude Opus 4.5 Thinking",
                      "reasoning": true,
                      "input": ["text"],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 200000,
                      "maxTokens": 8192
                    },
                    {
                      "id": "gemini-2.5-flash",
                      "name": "Gemini 2.5 Flash",
                      "reasoning": false,
                      "input": ["text"],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 1048576,
                      "maxTokens": 8192
                    },
                    {
                      "id": "gemini-2.5-pro",
                      "name": "Gemini 2.5 Pro",
                      "reasoning": false,
                      "input": ["text"],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 2097152,
                      "maxTokens": 8192
                    }
                  ]
                }
              }
            },
            "hooks": {
              "enabled": true,
              "path": "/webhooks",
              "token": "{{ .GITHUB_WEBHOOK_SECRET }}",
              "maxBodyBytes": 262144,
              "transformsDir": "/home/node/.openclaw/workspace",
              "mappings": [
                {
                  "id": "github-pr-notifications",
                  "match": {
                    "path": "github"
                  },
                  "action": "agent",
                  "wakeMode": "now",
                  "name": "GitHub PR Handler",
                  "transform": {
                    "module": "./github-webhook-transform.js"
                  }
                }
              ]
            },
            "channels": {
              "discord": {
                "enabled": true,
                "dm": {
                  "enabled": false
                },
                "guilds": {
                  "{{ .DISCORD_SERVER_ID }}": {
                    "requireMention": false,
                    "channels": {
                      "{{ .DISCORD_CHANNEL_ID }}": {
                        "allow": true,
                        "requireMention": false
                      }
                    }
                  }
                }
              }
            },
            "plugins": {
              "entries": {
                "discord": {
                  "enabled": true
                }
              }
            },
            "gateway": {
              "mode": "local",
              "auth": {
                "mode": "token",
                "token": "{{ .OPENCLAW_GATEWAY_TOKEN }}"
              },
              "port": 18789,
              "bind": "loopback",
              "tailscale": {
                "mode": "off",
                "resetOnExit": false
              },
              "trustedProxies": ["10.244.1.115", "10.0.0.0/8", "10.244.0.0/16", "192.168.0.0/16"]
            },
            "messages": {
              "ackReactionScope": "group-mentions"
            },
            "wizard": {
              "lastRunAt": "2026-02-05T19:23:48.726Z",
              "lastRunVersion": "2026.2.3",
              "lastRunCommand": "doctor",
              "lastRunMode": "local"
            }
          }
  dataFrom:
    - extract:
        key: openclaw-secret
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
