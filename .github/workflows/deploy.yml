name: Deploy
on: 
  push:
    branches:
    - main

jobs:
    deploy_cloudflare:
      runs-on: ubuntu-latest
      steps:
        - name: Clone Repository
          uses: actions/checkout@v2
        - name: Deploy Stack
          uses: kgierke/portainer-stack-deployment@v1
          with:
            portainer-url: ${{ secrets.PORTAINER_URL}}
            portainer-username: ${{ secrets.PORTAINER_USERNAME }}
            portainer-password: ${{ secrets.PORTAINER_PASSWORD }}
            portainer-endpoint: 16
            name: cloudflare-ddns-test
            file: stacks/cloudflare-ddns.yml.mustache
            variables: '{"CLOUDFLARE_TOKEN": "${{ secrets.CLOUDFLARE_TOKEN}}"}'
