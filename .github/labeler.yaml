---
# Auto-labeler configuration
# Labels PRs based on changed files

# =============================================================================
# Area Labels - Infrastructure Categories (new structure)
# =============================================================================
area/networking:
  - changed-files:
      - any-glob-to-any-file: "infra/k8s/networking/**/*"

area/storage:
  - changed-files:
      - any-glob-to-any-file: "infra/k8s/storage/**/*"

area/security:
  - changed-files:
      - any-glob-to-any-file: "infra/k8s/security/**/*"

area/monitoring:
  - changed-files:
      - any-glob-to-any-file: "infra/k8s/monitoring/**/*"

area/cluster-management:
  - changed-files:
      - any-glob-to-any-file: "infra/k8s/cluster-management/**/*"

area/operators:
  - changed-files:
      - any-glob-to-any-file: "infra/k8s/operators/**/*"

# =============================================================================
# Area Labels - Application Categories
# =============================================================================
area/media:
  - changed-files:
      - any-glob-to-any-file: "apps/media/**/*"

area/data:
  - changed-files:
      - any-glob-to-any-file: "apps/data/**/*"

area/auth:
  - changed-files:
      - any-glob-to-any-file: "apps/auth/**/*"

# Generic apps (when not in specific category)
area/apps:
  - changed-files:
      - any-glob-to-any-file:
          - "apps/**/*"
          - "!apps/media/**/*"
          - "!apps/data/**/*"
          - "!apps/auth/**/*"

# =============================================================================
# Area Labels - Infrastructure Components
# =============================================================================
area/argocd:
  - changed-files:
      - any-glob-to-any-file:
          - "argocd/**/*"
          - "**/application.yaml"

area/ansible:
  - changed-files:
      - any-glob-to-any-file:
          - "infra/ansible/**/*"

area/talos:
  - changed-files:
      - any-glob-to-any-file:
          - "infra/talos/**/*"
          - "**/*talos*"

area/terraform:
  - changed-files:
      - any-glob-to-any-file:
          - "infra/terraform/**/*"
          - "terraform/**/*"
          - "**/*.tf"
          - "**/*.tfvars"

area/docker:
  - changed-files:
      - any-glob-to-any-file:
          - "stacks/**/*"
          - "**/docker-compose*.yaml"
          - "**/Dockerfile"

# =============================================================================
# Area Labels - Documentation and GitHub
# =============================================================================
area/docs:
  - changed-files:
      - any-glob-to-any-file:
          - "docs/**/*"
          - "*.md"  # Only root-level markdown files
          - "!.github/**/*.md"

area/github:
  - changed-files:
      - any-glob-to-any-file:
          - ".github/**/*"
          - "!.github/renovate/**/*"  # Exclude renovate (handled separately)

# =============================================================================
# Type Labels - Based on file patterns
# =============================================================================
type/docs:
  - changed-files:
      - any-glob-to-any-file:
          - "**/*.md"
          - "docs/**/*"

type/ci:
  - changed-files:
      - any-glob-to-any-file:
          - ".github/workflows/**/*"
          - ".github/actions/**/*"
          - "**/.gitlab-ci.yml"

# =============================================================================
# Renovate Labels
# =============================================================================
renovate/container:
  - all:
    - changed-files:
        - any-glob-to-any-file:
            - "**/values.yaml"  # Container image updates in Helm values
            - "**/docker-compose*.yaml"  # Docker compose image updates
            - "stacks/**/*"  # Docker compose stacks
    - head-branch:
        - "^renovate/.*"

renovate/helm:
  - all:
    - changed-files:
        - any-glob-to-any-file:
            - "**/application.yaml"  # ArgoCD application updates (chart versions)
            - "**/Chart.yaml"  # Helm chart dependency updates
    - head-branch:
        - "^renovate/.*"

renovate/github-action:
  - all:
    - changed-files:
        - any-glob-to-any-file:
            - ".github/workflows/**/*"  # GitHub Action version updates
    - head-branch:
        - "^renovate/.*"

# =============================================================================
# Special Labels
# =============================================================================
security:
  - changed-files:
      - any-glob-to-any-file:
          - "**/*secret*"
          - "**/*security*"
          - "**/*auth*"
          - "infra/k8s/security/**/*"
    head-branch:
      - ".*security.*"
      - ".*cve.*"
      - ".*vulnerability.*"

dependencies:
  - head-branch:
      - "^renovate/.*"
      - "^dependabot/.*"
      - ".*deps.*"
      - ".*dependencies.*"

breaking-change:
  - body-contains:
      - "BREAKING CHANGE"
      - "breaking change"
  - title-contains:
      - "!"  # Conventional commits breaking change indicator

# =============================================================================
# Cluster Labels
# =============================================================================
cluster/main:
  - changed-files:
      - any-glob-to-any-file:
          - "infra/talos/**/*"
          - "infra/k8s/cluster-management/**/*"
          - "infra/k8s/operators/**/*"
          - "infra/k8s/networking/**/*"
          - "infra/k8s/storage/**/*"
          - "infra/k8s/security/**/*"
