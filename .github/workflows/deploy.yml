name: Deploy
on: 
  push:
    branches:
    - master

jobs:
  deploy_cloudflare:
    runs-on: ubuntu-latest
    steps:
      - name: deploy to portainer
        uses: LGinC/portainer-stack-deploy@master
        with: 
          serverurl: ${{ secrets.PORTAINER_URL}}
          username: ${{ secrets.PORTAINER_USERNAME }}
          password: ${{ secrets.PORTAINER_PASSWORD }}
          endpointId: 1
          stackname: cloudflare-ddns-test
          imagenames: |
              xxx/xxx
              myhub.com/xx1/xxx
          variables: |
              tag=6.0-alpine
          env: |
              TZ=Asia/Shanghai
              myTag=App
          docker_compose: |
            version: '2'
            services:
              cloudflare-ddns:
                image: oznu/cloudflare-ddns:latest
                restart: always
                environment:
                  - API_KEY=${{ secrets.CLOUDFLARE_TOKEN}}
                  - ZONE=atoca.house
                  - PROXIED=true
