---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: openclaw-r2-secret
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    creationPolicy: Owner
    deletionPolicy: Retain
    template:
      data:
        RESTIC_REPOSITORY: "s3:{{ .RESTIC_REPOSITORY }}/openclaw"
        RESTIC_PASSWORD: "{{ .RESTIC_PASSWORD }}"
        AWS_ACCESS_KEY_ID: "{{ .AWS_ACCESS_KEY_ID }}"
        AWS_SECRET_ACCESS_KEY: "{{ .AWS_SECRET_ACCESS_KEY }}"
  dataFrom:
    - extract:
        key: volsync-restic-r2
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-secret
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: *name
    template:
      data:
        ## Gateway token for authentication
        OPENCLAW_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        ## Discord Bot Token
        DISCORD_BOT_TOKEN: "{{ .DISCORD_BOT_TOKEN }}"
        ## GH Access
        GITHUB_APP_CLIENT_ID: "{{ .BOT_APP_ID }}"
        GITHUB_APP_CLIENT_SECRET: "{{ .BOT_APP_CLIENT_SECRET }}"
        GITHUB_APP_ID: "{{ .BOT_APP_ID }}"
        GITHUB_APP_INSTALLATION_ID: "{{ .BOT_APP_INSTALLATION_ID }}"
        GITHUB_APP_PRIVATE_KEY: "{{ .BOT_APP_PRIVATE_KEY }}"
        ## API Keys
        GOOGLE_GEMINI_API_KEY: "{{ .GOOGLE_GEMINI_API_KEY }}"
        OLLAMA_API_KEY: "ollama-local"
        OLLAMA_HOST: "http://ollama.ollama.svc.cluster.local"
  dataFrom:
    - extract:
        key: openclaw-secret
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name openclaw-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: *name
    template:
      data:
        ## OpenClaw configuration file
        openclaw.json: |
          {
            "commands": {
              "native": "auto",
              "nativeSkills": "auto"
            },
            "browser": {
              "enabled": true,
              "defaultProfile": "headless",
              "profiles": {
                "headless": {
                  "cdpUrl": "http://localhost:9222",
                  "color": "#00AA00"
                }
              }
            },
            "agents": {
              "defaults": {
                "model": {
                  "primary": "ollama/qwen3:8b-q4_K_M"
                },
                "models": {
                  "ollama/qwen3:8b-q4_K_M": {
                    "streaming": true
                  },
                  "google/gemini-3-flash": {
                    "streaming": true
                  }
                },
                "workspace": "/home/node/.openclaw/workspace",
                "maxConcurrent": 4,
                "subagents": {
                  "maxConcurrent": 8
                },
                "memorySearch": {
                  "provider": "local",
                  "local": {
                    "modelPath": "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf"
                  },
                  "model": "gemini-embedding-001",
                  "sync": {
                    "watch": true
                  },
                  "query": {
                    "hybrid": {
                      "enabled": true,
                      "vectorWeight": 0.7,
                      "textWeight": 0.3
                    }
                  }
                },
                "heartbeat": {
                  "every": "30m",
                  "model": "ollama/qwen3:8b-q4_K_M",
                  "target": "discord",
                  "prompt": "Review workspace files (HEARTBEAT.md, TODO.md). Check for: pending tasks, blockers, opportunities to help proactively. Surface urgent items.",
                  "includeReasoning": false
                }
              }
            },
            "models": {
              "providers": {
                "google": {
                  "baseUrl": "https://generativelanguage.googleapis.com/v1beta",
                  "apiKey": "{{ .GOOGLE_GEMINI_API_KEY }}",
                  "api": "google-generative-ai",
                  "models": [
                    {
                      "id": "gemini-3-flash",
                      "name": "Gemini 3 Flash",
                      "reasoning": false,
                      "input": [
                        "text"
                      ],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 32760,
                      "maxTokens": 8192
                    }
                  ]
                },
                "ollama": {
                  "baseUrl": "http://ollama.ollama.svc.cluster.local/v1",
                  "api": "openai-completions",
                  "models": [
                    {
                      "id": "qwen3:8b-q4_K_M",
                      "name": "Qwen 3 8B",
                      "reasoning": false,
                      "input": [
                        "text"
                      ],
                      "cost": {
                        "input": 0,
                        "output": 0,
                        "cacheRead": 0,
                        "cacheWrite": 0
                      },
                      "contextWindow": 32760,
                      "maxTokens": 81920
                    }
                  ]
                }
              }
            },
            "auth": {
              "profiles": {
                "ollama:default": {
                  "provider": "ollama",
                  "mode": "api_key"
                }
              }
            },
            "channels": {
              "discord": {
                "enabled": true,
                "dm": {
                  "enabled": false
                },
                "guilds": {
                  "{{ .DISCORD_SERVER_ID }}": {
                    "requireMention": false,
                    "channels": {
                      "{{ .DISCORD_CHANNEL_ID }}": {
                        "allow": true,
                        "requireMention": false
                      }
                    }
                  }
                }
              }
            },
            "plugins": {
              "entries": {
                "discord": {
                  "enabled": true
                }
              }
            },
            "gateway": {
              "mode": "local",
              "auth": {
                "mode": "token",
                "token": "{{ .OPENCLAW_GATEWAY_TOKEN }}"
              },
              "trustedProxies": ["10.244.0.0/16", "192.168.0.0/16", "10.96.0.0/12"]
            },
            "messages": {
              "ackReactionScope": "group-mentions"
            },
            "wizard": {
              "lastRunAt": "2026-02-05T19:23:48.726Z",
              "lastRunVersion": "2026.2.3",
              "lastRunCommand": "doctor",
              "lastRunMode": "local"
            }
          }
  dataFrom:
    - extract:
        key: openclaw-secret
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
