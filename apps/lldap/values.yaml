controllers:
  lldap:
    replicas: 1
    strategy: RollingUpdate
    annotations:
      reloader.stakater.com/auto: "true"
    initContainers:
      init-db:
        image:
          repository: ghcr.io/home-operations/postgres-init
          tag: 17.6.0@sha256:86a1992d46273c58fd4ad95b626081dfaabfe16bd56944675169e406d1a660dd
        envFrom:
          - secretRef:
              name: lldap-db-secret
          - secretRef:
              name: lldap-dbinit-secret
    containers:
      lldap:
        image:
          repository: ghcr.io/lldap/lldap
          tag: v0.6.2@sha256:9e605a66c02514bfcffd1b67cafb1e98d50992216bb2871d7ae44622047dd09d
        env:
          TZ: Europe/Amsterdam
          LLDAP_HTTP_PORT: &port 80
          LLDAP_HTTP_URL: https://lldap.atoca.house
          LLDAP_LDAP_PORT: &ldapPort 389
        envFrom:
          - secretRef:
              name: lldap-db-secret
          - secretRef:
              name: lldap-secret
        probes:
          liveness:
            enabled: true
          readiness:
            enabled: true
        resources:
          requests:
            cpu: 5m
            memory: 36M
          limits:
            memory: 128M
    pod:
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: DoNotSchedule
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: lldap
service:
  lldap:
    controller: lldap
    ports:
      http:
        port: *port
        primary: true
      ldap:
        port: *ldapPort
ingress:
  lldap:
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: "cloudflare-prod"
    hosts:
      - host: lldap.atoca.house
        paths:
          - path: /
            service:
              identifier: lldap
              port: http
    tls:
      - hosts:
          - lldap.atoca.house
        secretName: lldap-tls
persistence:
  data:
    type: emptyDir